<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.10.xsd">

    <changeSet id="0.1" author="mvgrebenyuk">
        <sql>
            create table account (
                id uuid not null,
                email varchar(100) not null,
                phone varchar(100) not null,
                acc_details_id uuid not null
            );

            create table details (
                id uuid not null,
                account_id uuid not null,
                name varchar(100),
                surname varchar(100)
            );

            create table salepoint (
                id uuid not null,
                account_id uuid not null,
                name varchar(100)
            );

            create table dev_group (
                id uuid not null,
                account_id uuid not null,
                name varchar(100)
            );

            create table device (
                id uuid not null,
                account_id uuid,
                sp_id uuid,
                group_id uuid,
                type varchar(30) not null,
                serial uuid not null,
                status varchar(10) not null,
                image_url text
            );

        </sql>
    </changeSet>

    <changeSet id="0.2" author="mvgrebenyuk">
        <sql>
            create table image (
                id uuid not null,
                account_id uuid,
                image text
            )
        </sql>
    </changeSet>

    <changeSet id="0.3" author="mvgrebenyuk">
        <sql>
            alter table device drop column image_url;
        </sql>
    </changeSet>

    <changeSet id="0.4" author="mvgrebenyuk">
        <sql>
            create table account_images (
                                            account_id uuid not null,
                                            image_id uuid not null,
                                            primary key (account_id, image_id)
            );

            create table salepoint_images (
                                              salepoint_id uuid not null,
                                              image_id uuid not null,
                                              primary key (salepoint_id, image_id)
            );

            create table dev_group_images (
                                              dev_group_id uuid not null,
                                              image_id uuid not null,
                                              primary key (dev_group_id, image_id)
            );

            create table device_images (
                                           device_id uuid not null,
                                           image_id uuid not null,
                                           primary key (device_id, image_id)
            );

            create table details_images (
                                            details_id uuid not null,
                                            image_id uuid not null,
                                            primary key (details_id, image_id)
            );
        </sql>
    </changeSet>

    <changeSet id="0.5" author="mvgrebenyuk">
        <sql>
            alter table "account" drop column acc_details_id;
            alter table "account" add column company_type varchar(7) not null;
            alter table details rename column "name" to official_name;
            alter table details drop column surname;

            create table "user" (
                id uuid not null,
                email varchar(100) not null,
                phone varchar(13) not null,
                name varchar(20) not null,
                second_name varchar(20),
                surname varchar(30) not null
            );

            create table user_account (
                                            user_id uuid not null,
                                            account_id uuid not null,
                                            role varchar(10),
                                            position varchar(100),
                                            primary key (user_id, account_id)
            );


        </sql>
    </changeSet>




</databaseChangeLog>